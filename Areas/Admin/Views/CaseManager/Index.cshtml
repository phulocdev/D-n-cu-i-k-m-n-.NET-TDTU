@using CharityConnect.Models
@model IEnumerable<CharityConnect.Models.Case>

@{
    ViewBag.Title = "Danh sách hoàn cảnh";
}

@functions {
    string GetDeleteModalId(Case c)
    {
        return "#deleteModal" + c.CaseId;
    }

    string GetModalId(Case c)
    {
        return "deleteModal" + c.CaseId;
    }

}

<div class="d-flex align-items-center justify-content-between my-4">
         <h2 class="gj-font-size-16">Quản lý hoàn cảnh khó khăn</h2>
        <a asp-area="Admin" asp-controller="CaseManager" asp-action="AddEdit" class="btn btn-primary">Tạo mới hoàn cảnh</a>
</div>

<div class="card mb-4">
    <div class="card-header">
        <i class="fas fa-table me-1"></i>
       Danh sách cần sự hỗ trợ
    </div>
    <div class="card-body">
        <table id="datatablesSimple">
            <thead>
                <tr>
                    <th>Tiêu đề</th>
                    <th>Hình ảnh minh họa</th>
                    <th>Khu vực</th>
                    <th>Loại hoàn cảnh</th>
                    <th>Meta</th>
                    <th>Hành động</th>
                </tr>
            </thead>
            <tfoot>
                <tr>
                    <th>Tiêu đề</th>
                    <th>Hình ảnh minh họa</th>
                    <th>Khu vực</th>
                    <th>Loại hoàn cảnh</th>
                    <th>Meta</th>
                    <th>Hành động</th>
                </tr>  
            </tfoot>
            <tbody>
                  @foreach(Case c in Model)
                 {
                    <tr>
                        <td>@c.Title</td>
                        <td>
                            <div class="d-flex" style="width: 96px; height:96px;">
                                <img src="@Url.Content("~/images/" + c.ImageUrl)" alt="@c.Title" class="img-fluid object-fit-cover" style="width: 100%; height: 100%;" />
                            </div>
                        </td>
                        <td>@c.Location</td>
                        <td>
                            @foreach (Category category in ViewBag.Categories)
                            {
                                @if (category.CategoryId == c.CategoryId)  {
                                    @category.Name
                                }
                            }
                        </td>
                        <td>
                            <span class="text-truncate" style="max-width: 200px; display: -webkit-box; -webkit-line-clamp: 3; -webkit-box-orient: vertical; overflow: hidden;">
                                @c.Meta
                            </span>
                        </td>
                        <td>
                             <form asp-controller="CaseManager" asp-action="Delete" method="post">
                             <input type="hidden" name="id" value="@c.CaseId" />
                            <a class="btn btn-info" asp-area="Admin" asp-controller="CaseManager" asp-action="AddEdit" asp-route-id="@c.CaseId"><i class="bi bi-pencil-fill"></i></a>
                            <button type="button" class="btn btn-danger" data-bs-toggle="modal" data-bs-target="@GetDeleteModalId(c)">
                                <i class="bi bi-trash"></i>
                            </button>
                            <div class="modal fade" id="@GetModalId(c)" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
                                <div class="modal-dialog">
                                    <div class="modal-content">
                                        <div class="modal-header">
                                            <h1 class="modal-title fs-5" id="exampleModalLabel">
                                                Bạn có muốn xóa hoàn cảnh
                                                "@c.Title?"
                                            </h1>
                                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                        </div>

                                        <div class="modal-footer">
                                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Hủy</button>
                                            <button type="submit" class="btn btn-danger">Xóa</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            </form>
                        </td>
                    </tr>
                 }
            </tbody>
        </table>
    </div>
</div>