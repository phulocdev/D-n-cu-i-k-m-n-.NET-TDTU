@model Case

@{
    ViewBag.Title = $"{ViewBag.Operation} hoàn cảnh";
}
<link href="//maxcdn.bootstrapcdn.com/bootstrap/4.1.1/css/bootstrap.min.css" rel="stylesheet" id="bootstrap-css">
<script src="//maxcdn.bootstrapcdn.com/bootstrap/4.1.1/js/bootstrap.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>

<h4 class="col-12 mb-0 py-3">@ViewBag.Operation hoàn cảnh</h4>
<div class="my-3 p-4 border rounded bg-light">
    <form id="form" class="form-compact w-100" asp-area="Admin" asp-controller="CaseManager" asp-action="AddEdit" method="post" enctype="multipart/form-data">
    <input type="hidden" asp-for="CaseId" />
    <input type="hidden" asp-for="CategoryId" />
    <div class="row paddingBottom20">
        <div class="container col-12">
            <div class="form-group row align-items-center">
                <label for="Title" class="col-2 col-form-label-sm text-right">Tiêu đề</label>
                <div class="col-6">
                    <div class="input-group">
                        <input asp-for="Title" class="form-control form-control-sm" id="title" >
                    </div>
                </div>
            </div>
           
             <div class="form-group row align-items-center">
                <label for="Location" class="col-2 col-form-label-sm text-right">Khu vực</label>
                <div class="col-6">
                    <div class="input-group">
                        <input asp-for="Location" name="Location" class="form-control form-control-sm" />
                    </div>
                </div>
            </div>
            <div class="form-group row align-items-center">
                <label for="CategoryId" class="col-2 col-form-label-sm text-right">Loại hoàn cảnh</label>
                <div class="col-6">
                        <select asp-for="CategoryId" name="catId" class="form-control">
                            <option value="">-- Chọn loại hoàn cảnh --</option>
                            @foreach (Category category in ViewBag.Categories)
                            {
                                <option value="@category.CategoryId">@category.Name</option>
                            }
                        </select>
                </div>
            </div>

             <!-- CK Editor -->
            <div class="form-group row align-items-center">
                <label for="Description" class="col-2 col-form-label-sm text-right">Nội dung</label>
                <div class="col-10">
                      <textarea asp-for="Description" id="editor1" class="form-control"></textarea>
                </div>
            </div>


            <div class="form-group row align-items-center">
                <label for="imageUpload" class="col-2 col-form-label-sm text-right">Hình ảnh</label>
                    <div class="col-6">
                        <div class="input-group">
                            <input type="file" class="form-control form-control-sm" id="imageUpload" name="ImageFile" asp-for="ImageFile" />
                        </div>
                    </div>
            </div>
            <div class="form-group row align-items-center">
                <label for="Meta" class="col-2 col-form-label-sm text-right">Meta</label>
                <div class="col-6">
                    <div class="input-group">
                        <input asp-for="Meta" name="Meta" class="form-control form-control-sm" id="meta"/>
                    </div>
                </div>
            </div>
                <div class="form-group row align-items-center">
                    <label for="Hide" class="col-2 col-form-label-sm text-right">Ẩn/Hiện</label>
                    <div class="col-6">
                        <div class="form-check">
                            <input asp-for="Hide" name="Hide" class="form-check-input" type="checkbox" id="Hide" />
                            <label class="form-check-label" for="Hide"></label>
                        </div>
                    </div>
                </div>
                <div class="form-group row align-items-center">
                    <label for="Order" class="col-2 col-form-label-sm text-right">Thứ tự</label>
                    <div class="col-6">
                    <div class="input-group">
                        <input asp-for="Order" name="Order" class="form-control form-control-sm" />
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="form-group row align-items-center">
        <label for="Order" class="col-2 col-form-label-sm text-right"></label>
        <div class="col-6">
            <button type="submit" class="btn btn-primary">Lưu</button>
            <a asp-area="Admin" asp-action="Index" asp-controller="CaseManager" class="btn btn-outline-dark">Hủy</a>
        </div>
    </div>
</form>
</div>

@section Scripts {
    <script>
        // Initialize CKEditor
        CKEDITOR.replace('editor1', {
            height: 400
        });

        // Đồng bộ dữ liệu CKEditor với textarea trước khi submit
        $('#form').on('submit', function () {
            for (instance in CKEDITOR.instances) {
                CKEDITOR.instances[instance].updateElement();
            }
        });
    </script>
    <script>
        $(function () {
            $("#title").on("keyup", function () {
                var text = $.trim($(this).val().toLowerCase());

                // Chuẩn hóa chuỗi sang slug
                var slug = text
                    .replace(/á|à|ả|ã|ạ|ă|ắ|ằ|ẳ|ẵ|ặ|â|ấ|ầ|ẩ|ẫ|ậ|ä|å|ǎ/g, "a")
                    .replace(/é|è|ẻ|ẽ|ẹ|ê|ế|ề|ể|ễ|ệ|ë/g, "e")
                    .replace(/í|ì|ỉ|ĩ|ị|î|ï/g, "i")
                    .replace(/ó|ò|ỏ|õ|ọ|ô|ố|ồ|ổ|ỗ|ộ|ơ|ớ|ờ|ở|ỡ|ợ|ö|ø|ǒ/g, "o")
                    .replace(/ú|ù|ủ|ũ|ụ|ư|ứ|ừ|ử|ữ|ự|û|ü|ǔ/g, "u")
                    .replace(/ý|ỳ|ỷ|ỹ|ỵ|ÿ/g, "y")
                    .replace(/đ/g, "d")
                    .replace(/[^a-z0-9]+/g, "-") // Thay thế các ký tự không hợp lệ bằng dấu '-'
                    .replace(/^-+|-+$/g, "");    // Loại bỏ dấu '-' thừa ở đầu và cuối chuỗi

                // Gán giá trị vào ô meta
                $('#meta').val(slug);
            });
        });
    </script>

}